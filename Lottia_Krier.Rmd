---
title: "Lottia.digitalis"
author: "Lilli Krier"
date: "10-21-19"
output: html_document
---

# Setup

```{r warning=F}
library(rentrez)
library(ape)
library(pegas)
library(strataG)
library(stringr)
library(knitr)

#set the working directory
opts_knit$set(root.dir = "~/Users/crandall_lab/Desktop/Lilli_Krier/CapeMendocino")
  


# read in the data to a DNAbin object

Ldigitalis <-read.FASTA("Final_Lottia_Alignments/Lottia_digitalis.fasta")
```

# Initial look at data

Align the data and look at a quick image of it

```{r}
Ldigitalis <- muscle(Ldigitalis)

image.DNAbin(Ldigitalis)

```

## Haplotype network

First make a network that colors each population separately

```{r}
#make a population map by stripping the population name off of the DNAbin labels
pop <- str_extract(rownames(Ldigitalis),"[A-Za-z]+\\s*[A-Za-z]+")

#Label the haplotypes and sort
h <- pegas::haplotype(Ldigitalis)
h <- sort(h, what = "label")
#Create the network
net <- pegas::haploNet(h)
#Funky code to make a table of which haplotypes occur in which populations
i<-stack(setNames(attr(h, "index"), rownames(h)))
i<-i[order(i$values),]
ind.hap<-table(hap=i$ind, pop=pop)
# put columns of ind.hap into North to South order
ind.hap<-ind.hap[,c("Patricks Point","Trinidad Head","Shelter Cove","Kibesillah")]

#Pick some funky colors
mycolors <- c("seagreen1","seagreen3","plum1", "plum3")

colormap <- str_replace(pop,"Trinidad Head", mycolors[1])
colormap <- str_replace(colormap,"Patricks Point", mycolors[2])
colormap <- str_replace(colormap,"Shelter Cove", mycolors[3])
colormap <- str_replace(colormap,"Kibesillah", mycolors[4])

plot(net, size=attr(net,"freq"), scale.ratio=2, pie = ind.hap, legend = F, labels = F, threshold = 0, show.mutation = 2, fast = T, bg = mycolors)

legend("bottomleft", colnames(ind.hap), col=mycolors, pch=19, ncol = 2)


```





